ATSchema updater section
========================

An AT schema updater pipeline section is another important transmogrifier
content import pipeline element. It updates field values for Archetypes
objects based on their schema based on the items it processes. The AT schema
updater section blueprint name is
``collective.transmogrifier.sections.atschemaupdater``. AT Schema updater
sections operate on objects already present in the ZODB, be they created by a
constructor or pre-existing objects.

Schema updating needs at least 1 piece of information: the path to the object
to update. To determine the path, the schema updater section inspects each
item and looks for one key, as described below. Any item missing this piece of
information will be skipped. Similarly, items with a path that doesn't exist
or are not Archetypes objects will be skipped as well.

For the object path, it'll look (in order) for
``_collective.transmogrifier.sections.atschemaupdater_[sectionname]_path``,
``_collective.transmogrifier.sections.atschemaupdater_path``,
``_[sectionname]_path`` and ``_path``, where ``[sectionname]`` is replaced
with the name given to the current section. This allows you to target the
right section precisely if needed. Alternatively, you can specify what key to
use for the path by specifying the ``path-key`` option, which should be a list
of keys to try (one key per line, use a ``re:`` or ``regexp:`` prefix to
specify regular expressions).

Unicode paths are encoded to ASCII. Paths to objects are always interpreted as
relative to the portal object. Any writable field who's id matches a key in
the current item will be updated with the corresponding value, using the
field's mutator.

>>> import pprint
>>> atschema = """
... [transmogrifier]
... pipeline =
...     schemasource
...     schemaupdater
...     printer
...     
... [schemasource]
... blueprint = collective.transmogrifier.sections.tests.schemasource
... 
... [schemaupdater]
... blueprint = collective.transmogrifier.sections.atschemaupdater
... 
... [printer]
... blueprint = collective.transmogrifier.sections.tests.pprinter
... """
>>> registerConfig(u'collective.transmogrifier.sections.tests.atschema',
...                atschema)
>>> transmogrifier(u'collective.transmogrifier.sections.tests.atschema')
{'_path': '/spam/eggs/foo',
 'fieldone': 'one value',
 'fieldtwo': 2,
 'nosuchfield': 'ignored'}
{'_path': 'not/existing/bar',
 'fieldone': 'one value',
 'title': 'Should not be updated, not an existing path'}
{'fieldone': 'one value', 'title': 'Should not be updated, no path'}
{'_path': '/spam/eggs/notatcontent',
 'fieldtwo': 2,
 'title': 'Should not be updated, not an AT base object'}
>>> pprint.pprint(plone.updated)
(('spam/eggs/foo', 'fieldone', 'one value'), ('spam/eggs/foo', 'fieldtwo', 2))
